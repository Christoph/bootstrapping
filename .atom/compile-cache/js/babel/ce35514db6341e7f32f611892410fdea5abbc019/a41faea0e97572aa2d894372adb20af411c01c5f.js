function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

/** @babel */

var _specHelpers = require('./spec-helpers');

var _specHelpers2 = _interopRequireDefault(_specHelpers);

describe('OpenerRegistry', function () {
  var filePath = 'wibble.pdf';
  // The various viewers
  var cannotOpen = undefined,
      canOpen = undefined,
      canOpenInBackground = undefined,
      canOpenWithSynctex = undefined;

  beforeEach(function () {
    waitsForPromise(function () {
      return _specHelpers2['default'].activatePackages();
    });
  });

  function createOpener(name, canOpen, hasSynctex, canOpenInBackground) {
    var instance = jasmine.createSpyObj(name, ['canOpen', 'open', 'hasSynctex', 'canOpenInBackground']);
    instance.canOpen.andReturn(canOpen);
    instance.open.andCallFake(function () {
      return Promise.resolve(undefined);
    });
    instance.hasSynctex.andReturn(hasSynctex);
    instance.canOpenInBackground.andReturn(canOpenInBackground);
    latex.opener.openers.set(name, instance);
    return instance;
  }

  beforeEach(function () {
    latex.opener.openers.clear();
    // The opener names have to conform to latex.opener schema
    cannotOpen = createOpener('skim', false, true, true);
    canOpen = createOpener('xdg-open', true, false, false);
    canOpenInBackground = createOpener('okular', true, false, true);
    canOpenWithSynctex = createOpener('evince', true, true, false);
  });

  describe('open', function () {
    it('opens using preferred viewer even if it does not have requested features', function () {
      atom.config.set('latex.enableSynctex', true);
      atom.config.set('latex.openResultInBackground', true);
      atom.config.set('latex.opener', 'xdg-open');

      waitsForPromise(function () {
        return latex.opener.open(filePath);
      });

      runs(function () {
        expect(cannotOpen.open).not.toHaveBeenCalled();
        expect(canOpen.open).toHaveBeenCalled();
        expect(canOpenInBackground.open).not.toHaveBeenCalled();
        expect(canOpenWithSynctex.open).not.toHaveBeenCalled();
      });
    });

    it('opens viewer that supports SyncTeX when enabled', function () {
      atom.config.set('latex.enableSynctex', true);
      atom.config.set('latex.openResultInBackground', true);
      atom.config.set('latex.opener', 'automatic');

      waitsForPromise(function () {
        return latex.opener.open(filePath);
      });

      runs(function () {
        expect(cannotOpen.open).not.toHaveBeenCalled();
        expect(canOpen.open).not.toHaveBeenCalled();
        expect(canOpenInBackground.open).not.toHaveBeenCalled();
        expect(canOpenWithSynctex.open).toHaveBeenCalled();
      });
    });

    it('opens viewer that supports background opening when enabled', function () {
      atom.config.set('latex.enableSynctex', false);
      atom.config.set('latex.openResultInBackground', true);
      atom.config.set('latex.opener', 'automatic');

      waitsForPromise(function () {
        return latex.opener.open(filePath);
      });

      runs(function () {
        expect(cannotOpen.open).not.toHaveBeenCalled();
        expect(canOpen.open).not.toHaveBeenCalled();
        expect(canOpenInBackground.open).toHaveBeenCalled();
        expect(canOpenWithSynctex.open).not.toHaveBeenCalled();
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9ob21lL2NocmlzLy5hdG9tL3BhY2thZ2VzL2xhdGV4L3NwZWMvb3BlbmVyLXJlZ2lzdHJ5LXNwZWMuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7OzsyQkFFb0IsZ0JBQWdCOzs7O0FBRXBDLFFBQVEsQ0FBQyxnQkFBZ0IsRUFBRSxZQUFNO0FBQy9CLE1BQU0sUUFBUSxHQUFHLFlBQVksQ0FBQTs7QUFFN0IsTUFBSSxVQUFVLFlBQUE7TUFBRSxPQUFPLFlBQUE7TUFBRSxtQkFBbUIsWUFBQTtNQUFFLGtCQUFrQixZQUFBLENBQUE7O0FBRWhFLFlBQVUsQ0FBQyxZQUFNO0FBQ2YsbUJBQWUsQ0FBQyxZQUFNO0FBQ3BCLGFBQU8seUJBQVEsZ0JBQWdCLEVBQUUsQ0FBQTtLQUNsQyxDQUFDLENBQUE7R0FDSCxDQUFDLENBQUE7O0FBRUYsV0FBUyxZQUFZLENBQUUsSUFBSSxFQUFFLE9BQU8sRUFBRSxVQUFVLEVBQUUsbUJBQW1CLEVBQUU7QUFDckUsUUFBTSxRQUFRLEdBQUcsT0FBTyxDQUFDLFlBQVksQ0FBQyxJQUFJLEVBQUUsQ0FBQyxTQUFTLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxxQkFBcUIsQ0FBQyxDQUFDLENBQUE7QUFDckcsWUFBUSxDQUFDLE9BQU8sQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLENBQUE7QUFDbkMsWUFBUSxDQUFDLElBQUksQ0FBQyxXQUFXLENBQUM7YUFBTSxPQUFPLENBQUMsT0FBTyxDQUFDLFNBQVMsQ0FBQztLQUFBLENBQUMsQ0FBQTtBQUMzRCxZQUFRLENBQUMsVUFBVSxDQUFDLFNBQVMsQ0FBQyxVQUFVLENBQUMsQ0FBQTtBQUN6QyxZQUFRLENBQUMsbUJBQW1CLENBQUMsU0FBUyxDQUFDLG1CQUFtQixDQUFDLENBQUE7QUFDM0QsU0FBSyxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsR0FBRyxDQUFDLElBQUksRUFBRSxRQUFRLENBQUMsQ0FBQTtBQUN4QyxXQUFPLFFBQVEsQ0FBQTtHQUNoQjs7QUFFRCxZQUFVLENBQUMsWUFBTTtBQUNmLFNBQUssQ0FBQyxNQUFNLENBQUMsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFBOztBQUU1QixjQUFVLEdBQUcsWUFBWSxDQUFDLE1BQU0sRUFBRSxLQUFLLEVBQUUsSUFBSSxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ3BELFdBQU8sR0FBRyxZQUFZLENBQUMsVUFBVSxFQUFFLElBQUksRUFBRSxLQUFLLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDdEQsdUJBQW1CLEdBQUcsWUFBWSxDQUFDLFFBQVEsRUFBRSxJQUFJLEVBQUUsS0FBSyxFQUFFLElBQUksQ0FBQyxDQUFBO0FBQy9ELHNCQUFrQixHQUFHLFlBQVksQ0FBQyxRQUFRLEVBQUUsSUFBSSxFQUFFLElBQUksRUFBRSxLQUFLLENBQUMsQ0FBQTtHQUMvRCxDQUFDLENBQUE7O0FBRUYsVUFBUSxDQUFDLE1BQU0sRUFBRSxZQUFNO0FBQ3JCLE1BQUUsQ0FBQywwRUFBMEUsRUFBRSxZQUFNO0FBQ25GLFVBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLHFCQUFxQixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQzVDLFVBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLDhCQUE4QixFQUFFLElBQUksQ0FBQyxDQUFBO0FBQ3JELFVBQUksQ0FBQyxNQUFNLENBQUMsR0FBRyxDQUFDLGNBQWMsRUFBRSxVQUFVLENBQUMsQ0FBQTs7QUFFM0MscUJBQWUsQ0FBQztlQUFNLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQztPQUFBLENBQUMsQ0FBQTs7QUFFbEQsVUFBSSxDQUFDLFlBQU07QUFDVCxjQUFNLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO0FBQzlDLGNBQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtBQUN2QyxjQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDdkQsY0FBTSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO09BQ3ZELENBQUMsQ0FBQTtLQUNILENBQUMsQ0FBQTs7QUFFRixNQUFFLENBQUMsaURBQWlELEVBQUUsWUFBTTtBQUMxRCxVQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUM1QyxVQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyw4QkFBOEIsRUFBRSxJQUFJLENBQUMsQ0FBQTtBQUNyRCxVQUFJLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxjQUFjLEVBQUUsV0FBVyxDQUFDLENBQUE7O0FBRTVDLHFCQUFlLENBQUM7ZUFBTSxLQUFLLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxRQUFRLENBQUM7T0FBQSxDQUFDLENBQUE7O0FBRWxELFVBQUksQ0FBQyxZQUFNO0FBQ1QsY0FBTSxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtBQUM5QyxjQUFNLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFDLEdBQUcsQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO0FBQzNDLGNBQU0sQ0FBQyxtQkFBbUIsQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtBQUN2RCxjQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtPQUNuRCxDQUFDLENBQUE7S0FDSCxDQUFDLENBQUE7O0FBRUYsTUFBRSxDQUFDLDREQUE0RCxFQUFFLFlBQU07QUFDckUsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMscUJBQXFCLEVBQUUsS0FBSyxDQUFDLENBQUE7QUFDN0MsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsOEJBQThCLEVBQUUsSUFBSSxDQUFDLENBQUE7QUFDckQsVUFBSSxDQUFDLE1BQU0sQ0FBQyxHQUFHLENBQUMsY0FBYyxFQUFFLFdBQVcsQ0FBQyxDQUFBOztBQUU1QyxxQkFBZSxDQUFDO2VBQU0sS0FBSyxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDO09BQUEsQ0FBQyxDQUFBOztBQUVsRCxVQUFJLENBQUMsWUFBTTtBQUNULGNBQU0sQ0FBQyxVQUFVLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUE7QUFDOUMsY0FBTSxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtBQUMzQyxjQUFNLENBQUMsbUJBQW1CLENBQUMsSUFBSSxDQUFDLENBQUMsZ0JBQWdCLEVBQUUsQ0FBQTtBQUNuRCxjQUFNLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLENBQUMsR0FBRyxDQUFDLGdCQUFnQixFQUFFLENBQUE7T0FDdkQsQ0FBQyxDQUFBO0tBQ0gsQ0FBQyxDQUFBO0dBQ0gsQ0FBQyxDQUFBO0NBQ0gsQ0FBQyxDQUFBIiwiZmlsZSI6Ii9ob21lL2NocmlzLy5hdG9tL3BhY2thZ2VzL2xhdGV4L3NwZWMvb3BlbmVyLXJlZ2lzdHJ5LXNwZWMuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKiogQGJhYmVsICovXG5cbmltcG9ydCBoZWxwZXJzIGZyb20gJy4vc3BlYy1oZWxwZXJzJ1xuXG5kZXNjcmliZSgnT3BlbmVyUmVnaXN0cnknLCAoKSA9PiB7XG4gIGNvbnN0IGZpbGVQYXRoID0gJ3dpYmJsZS5wZGYnXG4gIC8vIFRoZSB2YXJpb3VzIHZpZXdlcnNcbiAgbGV0IGNhbm5vdE9wZW4sIGNhbk9wZW4sIGNhbk9wZW5JbkJhY2tncm91bmQsIGNhbk9wZW5XaXRoU3luY3RleFxuXG4gIGJlZm9yZUVhY2goKCkgPT4ge1xuICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiB7XG4gICAgICByZXR1cm4gaGVscGVycy5hY3RpdmF0ZVBhY2thZ2VzKClcbiAgICB9KVxuICB9KVxuXG4gIGZ1bmN0aW9uIGNyZWF0ZU9wZW5lciAobmFtZSwgY2FuT3BlbiwgaGFzU3luY3RleCwgY2FuT3BlbkluQmFja2dyb3VuZCkge1xuICAgIGNvbnN0IGluc3RhbmNlID0gamFzbWluZS5jcmVhdGVTcHlPYmoobmFtZSwgWydjYW5PcGVuJywgJ29wZW4nLCAnaGFzU3luY3RleCcsICdjYW5PcGVuSW5CYWNrZ3JvdW5kJ10pXG4gICAgaW5zdGFuY2UuY2FuT3Blbi5hbmRSZXR1cm4oY2FuT3BlbilcbiAgICBpbnN0YW5jZS5vcGVuLmFuZENhbGxGYWtlKCgpID0+IFByb21pc2UucmVzb2x2ZSh1bmRlZmluZWQpKVxuICAgIGluc3RhbmNlLmhhc1N5bmN0ZXguYW5kUmV0dXJuKGhhc1N5bmN0ZXgpXG4gICAgaW5zdGFuY2UuY2FuT3BlbkluQmFja2dyb3VuZC5hbmRSZXR1cm4oY2FuT3BlbkluQmFja2dyb3VuZClcbiAgICBsYXRleC5vcGVuZXIub3BlbmVycy5zZXQobmFtZSwgaW5zdGFuY2UpXG4gICAgcmV0dXJuIGluc3RhbmNlXG4gIH1cblxuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBsYXRleC5vcGVuZXIub3BlbmVycy5jbGVhcigpXG4gICAgLy8gVGhlIG9wZW5lciBuYW1lcyBoYXZlIHRvIGNvbmZvcm0gdG8gbGF0ZXgub3BlbmVyIHNjaGVtYVxuICAgIGNhbm5vdE9wZW4gPSBjcmVhdGVPcGVuZXIoJ3NraW0nLCBmYWxzZSwgdHJ1ZSwgdHJ1ZSlcbiAgICBjYW5PcGVuID0gY3JlYXRlT3BlbmVyKCd4ZGctb3BlbicsIHRydWUsIGZhbHNlLCBmYWxzZSlcbiAgICBjYW5PcGVuSW5CYWNrZ3JvdW5kID0gY3JlYXRlT3BlbmVyKCdva3VsYXInLCB0cnVlLCBmYWxzZSwgdHJ1ZSlcbiAgICBjYW5PcGVuV2l0aFN5bmN0ZXggPSBjcmVhdGVPcGVuZXIoJ2V2aW5jZScsIHRydWUsIHRydWUsIGZhbHNlKVxuICB9KVxuXG4gIGRlc2NyaWJlKCdvcGVuJywgKCkgPT4ge1xuICAgIGl0KCdvcGVucyB1c2luZyBwcmVmZXJyZWQgdmlld2VyIGV2ZW4gaWYgaXQgZG9lcyBub3QgaGF2ZSByZXF1ZXN0ZWQgZmVhdHVyZXMnLCAoKSA9PiB7XG4gICAgICBhdG9tLmNvbmZpZy5zZXQoJ2xhdGV4LmVuYWJsZVN5bmN0ZXgnLCB0cnVlKVxuICAgICAgYXRvbS5jb25maWcuc2V0KCdsYXRleC5vcGVuUmVzdWx0SW5CYWNrZ3JvdW5kJywgdHJ1ZSlcbiAgICAgIGF0b20uY29uZmlnLnNldCgnbGF0ZXgub3BlbmVyJywgJ3hkZy1vcGVuJylcblxuICAgICAgd2FpdHNGb3JQcm9taXNlKCgpID0+IGxhdGV4Lm9wZW5lci5vcGVuKGZpbGVQYXRoKSlcblxuICAgICAgcnVucygoKSA9PiB7XG4gICAgICAgIGV4cGVjdChjYW5ub3RPcGVuLm9wZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgICAgZXhwZWN0KGNhbk9wZW4ub3BlbikudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICAgIGV4cGVjdChjYW5PcGVuSW5CYWNrZ3JvdW5kLm9wZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgICAgZXhwZWN0KGNhbk9wZW5XaXRoU3luY3RleC5vcGVuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICB9KVxuICAgIH0pXG5cbiAgICBpdCgnb3BlbnMgdmlld2VyIHRoYXQgc3VwcG9ydHMgU3luY1RlWCB3aGVuIGVuYWJsZWQnLCAoKSA9PiB7XG4gICAgICBhdG9tLmNvbmZpZy5zZXQoJ2xhdGV4LmVuYWJsZVN5bmN0ZXgnLCB0cnVlKVxuICAgICAgYXRvbS5jb25maWcuc2V0KCdsYXRleC5vcGVuUmVzdWx0SW5CYWNrZ3JvdW5kJywgdHJ1ZSlcbiAgICAgIGF0b20uY29uZmlnLnNldCgnbGF0ZXgub3BlbmVyJywgJ2F1dG9tYXRpYycpXG5cbiAgICAgIHdhaXRzRm9yUHJvbWlzZSgoKSA9PiBsYXRleC5vcGVuZXIub3BlbihmaWxlUGF0aCkpXG5cbiAgICAgIHJ1bnMoKCkgPT4ge1xuICAgICAgICBleHBlY3QoY2Fubm90T3Blbi5vcGVuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICAgIGV4cGVjdChjYW5PcGVuLm9wZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgICAgZXhwZWN0KGNhbk9wZW5JbkJhY2tncm91bmQub3Blbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgICBleHBlY3QoY2FuT3BlbldpdGhTeW5jdGV4Lm9wZW4pLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgfSlcbiAgICB9KVxuXG4gICAgaXQoJ29wZW5zIHZpZXdlciB0aGF0IHN1cHBvcnRzIGJhY2tncm91bmQgb3BlbmluZyB3aGVuIGVuYWJsZWQnLCAoKSA9PiB7XG4gICAgICBhdG9tLmNvbmZpZy5zZXQoJ2xhdGV4LmVuYWJsZVN5bmN0ZXgnLCBmYWxzZSlcbiAgICAgIGF0b20uY29uZmlnLnNldCgnbGF0ZXgub3BlblJlc3VsdEluQmFja2dyb3VuZCcsIHRydWUpXG4gICAgICBhdG9tLmNvbmZpZy5zZXQoJ2xhdGV4Lm9wZW5lcicsICdhdXRvbWF0aWMnKVxuXG4gICAgICB3YWl0c0ZvclByb21pc2UoKCkgPT4gbGF0ZXgub3BlbmVyLm9wZW4oZmlsZVBhdGgpKVxuXG4gICAgICBydW5zKCgpID0+IHtcbiAgICAgICAgZXhwZWN0KGNhbm5vdE9wZW4ub3Blbikubm90LnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgICBleHBlY3QoY2FuT3Blbi5vcGVuKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpXG4gICAgICAgIGV4cGVjdChjYW5PcGVuSW5CYWNrZ3JvdW5kLm9wZW4pLnRvSGF2ZUJlZW5DYWxsZWQoKVxuICAgICAgICBleHBlY3QoY2FuT3BlbldpdGhTeW5jdGV4Lm9wZW4pLm5vdC50b0hhdmVCZWVuQ2FsbGVkKClcbiAgICAgIH0pXG4gICAgfSlcbiAgfSlcbn0pXG4iXX0=